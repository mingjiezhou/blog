<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>通过 vuex 实现 vue-echarts 图表的手动 resize | Hexo</title><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/blog/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">通过 vuex 实现 vue-echarts 图表的手动 resize</h1><a id="logo" href="/blog/.">Hexo</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/blog/."><i class="fa fa-home"> Start</i></a><a href="/blog/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/blog/about/"><i class="fa fa-user"> Über</i></a><a href="/blog/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">通过 vuex 实现 vue-echarts 图表的手动 resize</h1><div class="post-meta">Mar 15, 2019</div><div class="post-content"><h4 id="背景介绍："><a href="#背景介绍：" class="headerlink" title="背景介绍："></a>背景介绍：</h4><p>项目有用到 <code>vue-echarts</code>, 百度推出的 <code>vue</code> 版本的 <code>Echarts</code>，图表自带响应式属性 <code>auto-resize</code>, 来实现窗口尺寸变化时，图表的尺寸自适应，但是发现它是靠监听 <code>window</code> 的 <code>onresize</code> 来实现的，而有时候当 <code>chart</code> 容器 尺寸变化时，<code>window</code> 窗口大小是不变的，比如我这次遇到的，侧边菜单栏的显示隐藏切换，导致内容区域整体部分宽度会变化，但是 <code>window</code> 没有变化，所以 <code>auto-resize</code> 不能监听这种情况来实现 <code>resize</code>。</p>
<h4 id="解决思路："><a href="#解决思路：" class="headerlink" title="解决思路："></a>解决思路：</h4><p><strong>一、能否模拟监听普通 Dom 的尺寸变化，然后调用 <code>echarts</code> 的 <code>resize</code> 事件</strong></p>
<p>具体做法有以下几种：</p>
<ol>
<li>初始化项目后，轮询，反复查看 Dom 尺寸是否变化，这种一听就感觉不好，开销太大。</li>
<li>监听元素的滚动事件，在 目标 Dom 里面包裹一个同等大小的 div，是隐藏不可见的，当目标 Dom 大小变化时，触发滚动事件。<a href="https://blog.crimx.com/2017/07/15/element-onresize/" target="_blank" rel="noopener">参考文章</a></li>
<li><p>通过 <code>MutationObserver</code> 监听 Dom 节点变化，<code>MutationObserver</code> 是在 DOM4 规范中定义的，它的前身是 <code>MutationEvent</code> 事件，该事件最初在 DOM2 事件规范中介绍，到来了 DOM3 事件规范中正式定义，但是由于该事件存在兼容性以及性能上的问题被弃用；可以用它来监听 Dom style 的变化, <strong>Demo 代码</strong>，<a href="http://javascript.ruanyifeng.com/dom/mutationobserver.html" target="_blank" rel="noopener">文档</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">	&lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;div id=&quot;demo&quot; style=&quot;background: blue; height: 200px; width: 100%&quot;&gt;</span><br><span class="line">		demo 内容</span><br><span class="line">	&lt;/div&gt;</span><br><span class="line">	&lt;script&gt;</span><br><span class="line">		var observer = new MutationObserver(function (mutations, observer) &#123;</span><br><span class="line">		    mutations.forEach(function (mutation) &#123;</span><br><span class="line">		        console.log(mutation);</span><br><span class="line">		    &#125;);</span><br><span class="line">		&#125;);</span><br><span class="line">		var config = &#123;</span><br><span class="line">		    attributes: true,</span><br><span class="line">		    attributeOldValue: true,</span><br><span class="line">		    attributeFilter: [</span><br><span class="line">		        &apos;style&apos;</span><br><span class="line">		    ]</span><br><span class="line">		&#125;;</span><br><span class="line">		var el = document.getElementById(&apos;demo&apos;);</span><br><span class="line">		</span><br><span class="line">		observer.observe(el, config);</span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Ie9-10 默认支持 div 的 <code>resize</code> 事件，可以直接通过 <code>div.attachEvent(&#39;onresize&#39;, handler)</code>; 的方式实现;其它浏览器,通过在 div 中添加一个内置 object 元素实现监听,设置 object 元素的 style 使其填充满 div，这样当 div 的 size 发生变化时，object 的 size 也会发生变化,然后监听 object 元素的 <code>contentDocument.defaultView(window对象)</code>的 <code>resize</code> 事件。<a href="https://www.cnblogs.com/zhtui/p/7059943.html" target="_blank" rel="noopener">参考文章</a></p>
</li>
</ol>
<p><strong>二、vue 实现方案</strong></p>
<p>斟酌了上面几种方案后，结合具体案例，我觉得还是用 <code>vuex</code> 写全局数据更好更方便一些，具体步骤如下</p>
<ol>
<li>侧边栏展开和隐藏按钮点击 - 触发事件 - 修改 <code>store</code> - ,在图表组件里面 <code>watch store</code> 的变化，然后执行 <code>resize</code> 函数。</li>
<li>关于 <code>resize()</code>, 因为 <code>vue-echarts</code> 插件已经是对 <code>echarts</code> 的封装，如果不修改它的代码的话，可以通过 this.$ref 访问子组件的实例，调用它的 resize()。<a href="https://cn.vuejs.org/v2/guide/components-edge-cases.html#%E8%AE%BF%E9%97%AE%E5%AD%90%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B%E6%88%96%E5%AD%90%E5%85%83%E7%B4%A0" target="_blank" rel="noopener">文档</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 注意的坑，1.要设置 width 2. width 变化有延迟，需要加个 timeout，不然看不到效果</span><br><span class="line">this.$refs.chart.resize(&#123;width: this.$refs.chart.offsetWidth&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>通过这篇文章，你因该了解了两个知识点，DOM的变化监控，以及通过 vuex 作为桥梁实现不同模块布局的变化监听，<code>autoresize</code> 的拓展实现手动触发；这就够了。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/blog/2019/03/16/怎么给开源项目提PR？/">怎么给开源项目提PR？</a><a class="next" href="/blog/2019/03/12/Javascript-中的爆栈/">Javascript 中的爆栈</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://zhoumingjie.com/blog"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/27/React 项目配置之 Win10 linux环境/">React 项目配置之 Win10 linux环境</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/16/怎么给开源项目提PR？/">怎么给开源项目提PR？</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/15/通过-vuex-实现-vue-echarts-图表的手动-resize/">通过 vuex 实现 vue-echarts 图表的手动 resize</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2019/03/12/Javascript-中的爆栈/">Javascript 中的爆栈</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/07/22/API 接口加密方案/">API 接口加密方案</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/07/05/JavaScript-获取地址栏参数/">JavaScript 获取地址栏参数</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/06/30/Window-下-MySQL-环境的安装/">Window 下 MySQL 环境的安装</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/31/JavaScript-中的12种循环遍历方法/">JavaScript 中的12种循环遍历方法</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/05/21/前端切图技巧/">前端切图技巧</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2018/03/30/require-js-基本用法/">require.js 基本用法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/blog/." rel="nofollow">Hexo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/blog/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=0.0.0"></script></div></body></html>